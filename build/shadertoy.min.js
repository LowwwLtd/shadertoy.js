/**
 * @author: Andre Venancio [andre@lowwwltd.com]
 * version: 0.0.2 [2015-11-22]
 */
var ShaderToy=function(){window.WebGLRenderingContext?this.init():console.error("You need a WebGL browser: Try get.webgl.org")};ShaderToy.prototype={constructor:ShaderToy.prototype,_ready:!1,_pause:!1,mouse:new Float32Array(2),_textureCount:0,width:320,height:240,version:"0.0.1",_vertexShader:["attribute vec2 position;","void main() {","   gl_Position = vec4( position, 0., 1. );","}"],_fragmentShader:["precision highp float;","uniform float iGlobalTime;","uniform vec2 iResolution;","uniform vec2 iMouse;","uniform sampler2D iChannel0;","void mainImage( out vec4 fragColor, in vec2 fragCoord ) { fragColor.rgb = vec3( 0.5 + 0.5 * cos( iGlobalTime ) ); }","void main() {","   vec4 color = vec4( 0., 0., 0., 1. );","   mainImage( color, gl_FragCoord.xy );","   gl_FragColor = color;","}"],_loadExternalFile:function(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a),d.onload=function(){200===d.status?b(d.response):c(Error(d.statusText))},d.onerror=function(){c(Error("Network Error"))},d.send()})},_createProgram:function(a,b){var c=this._createShader(a,this.gl.VERTEX_SHADER),d=this._createShader(b,this.gl.FRAGMENT_SHADER),e=this.gl.createProgram();return this.gl.attachShader(e,c),this.gl.attachShader(e,d),this.gl.linkProgram(e),e},_createShader:function(a,b){var c=this.gl.createShader(b);this.gl.shaderSource(c,a),this.gl.compileShader(c);var d=this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS);if(!d){var e=this.gl.getShaderInfoLog(c);return console.error("Error compiling shader",c,e),this.gl.deleteShader(c),null}return c},_createNoiseTextureBuffer:function(a,b){var c=new Uint8Array(a*b*4);c.width=a,c.height=b;for(var d=0;d<c.length;d+=4){var e=Math.round(255*Math.random());c[d+0]=e,c[d+1]=e,c[d+2]=e,c[d+3]=255}return c},_createTextureBuffer:function(){return this._createNoiseTextureBuffer(1,1)},_createTexture:function(a,b){this.gl.activeTexture(this.gl.TEXTURE0+(b||0));var c=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,c),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),a instanceof Float32Array?(this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,a.width,a.height,0,this.gl.RGBA,this.gl.FLOAT,a),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT)):(this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,a.width,a.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.generateMipmap(this.gl.TEXTURE_2D)),c},_getUniform:function(a){return this.program.uniforms||(this.program.uniforms={}),this.program.uniforms[a]||(this.program.uniforms[a]=this.gl.getUniformLocation(this.program,a)),this.program.uniforms[a]},_getAttribute:function(a){return this.program.atttributes||(this.program.atttributes={}),this.program.atttributes[a]||(this.program.atttributes[a]=this.gl.getAttribLocation(this.program,a)),this.program.atttributes[a]},_setU1f:function(a,b){this.gl.uniform1f(this._getUniform(a),b)},_setU2f:function(a,b,c){this.gl.uniform2f(this._getUniform(a),b,c)},_setU2fv:function(a,b){this.gl.uniform2fv(this._getUniform(a),b)},_setU1i:function(a,b){this.gl.uniform1i(this._getUniform(a),b)},_onBlur:function(a){this._pause=!0},_onFocus:function(a){this._pause=!1},_onMove:function(a){this.mouse[0]=a.layerX,this.mouse[1]=a.layerY},init:function(){var a=document.createElement("canvas");if(a.width=this.width,a.height=this.height,document.body.appendChild(a),window.addEventListener("blur",this._onBlur.bind(this)),window.addEventListener("focus",this._onFocus.bind(this)),window.addEventListener("mousemove",this._onMove.bind(this)),this.gl=a.getContext("webgl"),this.gl.getExtension("OES_texture_float"),this.gl.getExtension("OES_standard_derivatives"),!this.gl)return void console.error("Couldn't start WebGL. Try get.webgl.org/troubleshooting");var b=["\n%cShader%cToy %c v: "+this.version+"\n","background: #1A1A1A; color: #00ffff; font-size: x-large;","background: #00ffff; color: #1A1A1A; font-size: x-large;","background: transparent; color: #000000; font-size: x-small;"];window.shadertoycredits||(window.shadertoycredits=!0,console.log.apply(console,b)),this.texture=this._createTexture(this._createNoiseTextureBuffer(256,256),this._textureCount++);var c=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),d=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,d),this.gl.bufferData(this.gl.ARRAY_BUFFER,c,this.gl.STATIC_DRAW);var e=this._createProgram(this._vertexShader.join("\n"),this._fragmentShader.join("\n"));this.useProgram(e)},load:function(a){this._ready=!1,this._loadExternalFile(a).then(function(a){this.write(a)}.bind(this))},write:function(a){this._ready=!1,this._fragmentShader[5]=a;var b=this._createProgram(this._vertexShader.join("\n"),this._fragmentShader.join("\n"));this.useProgram(b)},useProgram:function(a){this.program=a,this.gl.useProgram(this.program),this.gl.enableVertexAttribArray(this._getAttribute("position")),this.gl.vertexAttribPointer(this._getAttribute("position"),2,this.gl.FLOAT,!1,0,0),this._setU2f("iResolution",this.width,this.height),this.startTime=Date.now(),this._ready=!0},updateTexture:function(a,b,c){this.gl.activeTexture(this.gl.TEXTURE0+(c||0)),this.gl.bindTexture(this.gl.TEXTURE_2D,a),b instanceof Float32Array?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b.width,b.height,0,this.gl.RGBA,this.gl.FLOAT,b):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b.width,b.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,b)},setSize:function(a,b){this.width=a,this.height=b,this.gl.canvas.width=this.width,this.gl.canvas.height=this.height,this.gl.viewportWidth=this.width,this.gl.viewportHeight=this.height,this.gl.viewport(0,0,this.width,this.height),this.program&&this._setU2f("iResolution",this.width,this.height)},clear:function(a,b,c,d){this.gl.clearColor(a||0,b||0,c||0,d||1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},render:function(){this._ready===!0&&(this._pause||(this._setU1f("iGlobalTime",(Date.now()-this.startTime)/1e3),this._setU2fv("iMouse",this.mouse),this._setU1i("iChannel0",this.texture),this.clear(),this.gl.drawArrays(this.gl.TRIANGLES,0,6)))}};